'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

var fail = function fail(why) {
  return { result: false, reason: why };
};

var check = function check(_ip) {
  return false;
}; // whargarbl todo comeback


var letterFilter = new RegExp('^[0-9\\.]+$');

var check_quad = function check_quad(quad) {

  for (var i = 0; i < 4; ++i) {
    // eslint-disable-line fp/no-loops

    var b = quad[i];
    if (b.length === 0) {
      return fail('Byte ' + i + ' must not be empty');
    }

    var bt = parseInt(b, 10);

    // needn't check below zero, because character filter prevents minus signs
    if (bt > 255) {
      return fail('Byte ' + i + ' must be below 256');
    }

    if (b[0] === '0' && bt > 0) {
      return fail('Nonzero byte ' + i + ' must not begin with zero');
    }

    if (b.length > 1 && bt === 0) {
      return fail('Zero byte ' + i + ' must not have multiple zeroes');
    }
  }

  return { result: true };
};

var is_quad_ex = function is_quad_ex(ip) {

  if (!(typeof ip === 'string')) {
    return fail('All quads are strings');
  }

  if (!letterFilter.test(ip)) {
    return fail('A quad may only contain 0-9 and period');
  }

  var quad = ip.split('.');
  if (!(quad.length === 4)) {
    return fail('All complete quads have four bytes separated by periods');
  }

  return check_quad(quad);
};

var is_quad = function is_quad(ip) {
  return is_quad_ex(ip).result;
};

var is_integer = function is_integer(ip) {
  return Number.isInteger(ip) && ip >= 0 && ip <= 4294967295;
}; // 255.255.255.255


var integer_to_quad = function integer_to_quad(ip) {

  if (!Number.isInteger(ip)) {
    throw new TypeError('integer_to_quad accepts only integers');
  }

  if (ip < 0) {
    throw new RangeError('IP integer must be non-negative');
  }
  if (ip > 4294967295) {
    throw new RangeError('Maximum IP integer is 4,294,967,295');
  }

  return (ip >> 24 & 0xFF) + '.' + (ip >> 16 & 0xFF) + '.' + (ip >> 8 & 0xFF) + '.' + (ip & 0xFF); // eslint-disable-line no-bitwise
};

var int_array_to_quad = function int_array_to_quad(ia) {

  if (!Array.isArray(ia)) {
    throw new TypeError('int_array_to_quad requires an array of unsigned byte integers');
  }

  if (ia.length < 4 || ia.length > 4) {
    throw new RangeError('int_array_to_quad requires a 4-byte array');
  }

  // can't be a map to validate, because a map will skip holes
  for (var i = 0; i < 4; ++i) {
    // eslint-disable-line fp/no-loops

    var byte = ia[i];

    if (byte === undefined || byte === null || isNaN(byte)) {
      throw new TypeError('byte ' + i + ' must not be undefined, null, or NaN');
    }

    if (!Number.isInteger(byte)) {
      throw new TypeError('int_array_to_quad accepts only arrays of integers');
    }

    if (byte < 0) {
      throw new RangeError('byte ' + i + ' should be non-negative');
    }

    if (byte > 255) {
      throw new RangeError('byte ' + i + ' should be 255 or lower (y\'know, a byte)');
    }
  }

  return ia[0] + '.' + ia[1] + '.' + ia[2] + '.' + ia[3];
};

function ParsedQuad(a, b, c, d) {

  this.a = a;
  this.b = b;
  this.c = c;
  this.d = d;

  return this;
}

var parsed_quad_to_quad = function parsed_quad_to_quad(_ref) {
  var a = _ref.a,
      b = _ref.b,
      c = _ref.c,
      d = _ref.d;
  return a + '.' + b + '.' + c + '.' + d;
};

var as_quad = function as_quad(ip) {

  if (typeof ip === 'number') {
    return integer_to_quad(ip);
  } else if (ip instanceof ParsedQuad) {
    return parsed_quad_to_quad(ip);
  } else if (Array.isArray(ip)) {
    return int_array_to_quad(ip);
  } else if (is_quad(ip)) {
    return ip;
  }

  throw new Error('cannot construct quad from this input');
};

// todo whargarbl comeback needs to handle integers

var as_parsed_quad = function as_parsed_quad(ip) {

  if (ip instanceof ParsedQuad) {
    return ip;
  }

  var bytes = as_quad(ip).split('.').map(function (s) {
    return parseInt(s, 10);
  });

  return new (Function.prototype.bind.apply(ParsedQuad, [null].concat(_toConsumableArray(bytes))))();
};

exports.is_quad = is_quad;
exports.is_quad_ex = is_quad_ex;
exports.integer_to_quad = integer_to_quad;
exports.int_array_to_quad = int_array_to_quad;
exports.ParsedQuad = ParsedQuad;
exports.parsed_quad_to_quad = parsed_quad_to_quad;
exports.is_integer = is_integer;
exports.as_quad = as_quad;
exports.as_parsed_quad = as_parsed_quad;
exports.check = check;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9qcy9pc19pcHY0LmpzIl0sIm5hbWVzIjpbImZhaWwiLCJ3aHkiLCJyZXN1bHQiLCJyZWFzb24iLCJjaGVjayIsIl9pcCIsImxldHRlckZpbHRlciIsIlJlZ0V4cCIsImNoZWNrX3F1YWQiLCJxdWFkIiwiaSIsImIiLCJsZW5ndGgiLCJidCIsInBhcnNlSW50IiwiaXNfcXVhZF9leCIsImlwIiwidGVzdCIsInNwbGl0IiwiaXNfcXVhZCIsImlzX2ludGVnZXIiLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJpbnRlZ2VyX3RvX3F1YWQiLCJUeXBlRXJyb3IiLCJSYW5nZUVycm9yIiwiaW50X2FycmF5X3RvX3F1YWQiLCJpYSIsIkFycmF5IiwiaXNBcnJheSIsImJ5dGUiLCJ1bmRlZmluZWQiLCJpc05hTiIsIlBhcnNlZFF1YWQiLCJhIiwiYyIsImQiLCJwYXJzZWRfcXVhZF90b19xdWFkIiwiYXNfcXVhZCIsIkVycm9yIiwiYXNfcGFyc2VkX3F1YWQiLCJieXRlcyIsIm1hcCIsInMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBY0EsSUFBTUEsT0FBaUIsU0FBakJBLElBQWlCLENBQUNDLEdBQUQ7QUFBQSxTQUVwQixFQUFFQyxRQUFRLEtBQVYsRUFBaUJDLFFBQVFGLEdBQXpCLEVBRm9CO0FBQUEsQ0FBdkI7O0FBUUEsSUFBTUcsUUFBa0IsU0FBbEJBLEtBQWtCLENBQUNDLEdBQUQ7QUFBQSxTQUV0QixLQUZzQjtBQUFBLENBQXhCLEMsQ0FFVTs7O0FBTVYsSUFBTUMsZUFBdUIsSUFBSUMsTUFBSixDQUFXLGFBQVgsQ0FBN0I7O0FBTUEsSUFBTUMsYUFBdUIsU0FBdkJBLFVBQXVCLENBQUNDLElBQUQsRUFBMkM7O0FBRXRFLE9BQUssSUFBSUMsSUFBWSxDQUFyQixFQUF3QkEsSUFBRSxDQUExQixFQUE2QixFQUFFQSxDQUEvQixFQUFrQztBQUFFOztBQUVsQyxRQUFNQyxJQUFZRixLQUFLQyxDQUFMLENBQWxCO0FBQ0EsUUFBSUMsRUFBRUMsTUFBRixL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bi8vIEBmbG93XG5cbmltcG9ydCB0eXBlIHtcblxuICBJcCxcbiAgUmVzdWx0XG5cbn0gZnJvbSAnLi90eXBlcyc7XG5cblxuXG5cblxuY29uc3QgZmFpbDogRnVuY3Rpb24gPSAod2h5OiBzdHJpbmcpOiBSZXN1bHQgPT5cblxuICAoeyByZXN1bHQ6IGZhbHNlLCByZWFzb246IHdoeSB9KTtcblxuXG5cblxuXG5jb25zdCBjaGVjazogRnVuY3Rpb24gPSAoX2lwOiBJcCk6IGJvb2xlYW4gPT5cblxuICBmYWxzZTsgIC8vIHdoYXJnYXJibCB0b2RvIGNvbWViYWNrXG5cblxuXG5cblxuY29uc3QgbGV0dGVyRmlsdGVyOiBSZWdFeHAgPSBuZXcgUmVnRXhwKCdeWzAtOVxcXFwuXSskJyk7XG5cblxuXG5cblxuY29uc3QgY2hlY2tfcXVhZDogRnVuY3Rpb24gPSAocXVhZDogQXJyYXk8c3RyaW5nPik6IFJlc3VsdCB8IGJvb2xlYW4gPT4ge1xuXG4gIGZvciAobGV0IGk6IG51bWJlciA9IDA7IGk8NDsgKytpKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgZnAvbm8tbG9vcHNcblxuICAgIGNvbnN0IGI6IHN0cmluZyA9IHF1YWRbaV07XG4gICAgaWYgKGIubGVuZ3RoID09PSAwKSB7IHJldHVybiBmYWlsKGBCeXRlICR7aX0gbXVzdCBub3QgYmUgZW1wdHlgKTsgfVxuXG4gICAgY29uc3QgYnQ6IG51bWJlciA9IHBhcnNlSW50KGIsIDEwKTtcblxuICAgIC8vIG5lZWRuJ3QgY2hlY2sgYmVsb3cgemVybywgYmVjYXVzZSBjaGFyYWN0ZXIgZmlsdGVyIHByZXZlbnRzIG1pbnVzIHNpZ25zXG4gICAgaWYgKGJ0ID4gMjU1KSB7IHJldHVybiBmYWlsKGBCeXRlICR7aX0gbXVzdCBiZSBiZWxvdyAyNTZgKTsgfVxuXG4gICAgaWYgKChiWzBdID09PSAnMCcpICYmIChidCA+IDApKSB7XG4gICAgICByZXR1cm4gZmFpbChgTm9uemVybyBieXRlICR7aX0gbXVzdCBub3QgYmVnaW4gd2l0aCB6ZXJvYCk7XG4gICAgfVxuXG4gICAgaWYgKChiLmxlbmd0aCA+IDEpICYmIChidCA9PT0gMCkpIHtcbiAgICAgIHJldHVybiBmYWlsKGBaZXJvIGJ5dGUgJHtpfSBtdXN0IG5vdCBoYXZlIG11bHRpcGxlIHplcm9lc2ApO1xuICAgIH1cblxuICB9XG5cbiAgcmV0dXJuIHsgcmVzdWx0OiB0cnVlIH07XG5cbn07XG5cblxuXG5cblxuY29uc3QgaXNfcXVhZF9leDogRnVuY3Rpb24gPSAoaXA6IElwKTogUmVzdWx0ID0+IHtcblxuICBpZiAoISggdHlwZW9mKGlwKSA9PT0gJ3N0cmluZycgKSkge1xuICAgIHJldHVybiBmYWlsKCdBbGwgcXVhZHMgYXJlIHN0cmluZ3MnKTtcbiAgfVxuXG4gIGlmICghKCBsZXR0ZXJGaWx0ZXIudGVzdChpcCkgKSkge1xuICAgIHJldHVybiBmYWlsKCdBIHF1YWQgbWF5IG9ubHkgY29udGFpbiAwLTkgYW5kIHBlcmlvZCcpO1xuICB9XG5cblxuICBjb25zdCBxdWFkOiBBcnJheTxzdHJpbmc+ID0gaXAuc3BsaXQoJy4nKTtcbiAgaWYgKCEocXVhZC5sZW5ndGggPT09IDQpKSB7IHJldHVybiBmYWlsKCdBbGwgY29tcGxldGUgcXVhZHMgaGF2ZSBmb3VyIGJ5dGVzIHNlcGFyYXRlZCBieSBwZXJpb2RzJyk7IH1cblxuICByZXR1cm4gY2hlY2tfcXVhZChxdWFkKTtcblxufTtcblxuXG5cblxuXG5jb25zdCBpc19xdWFkOiBGdW5jdGlvbiA9IChpcDogSXApOiBib29sZWFuID0+XG5cbiAgaXNfcXVhZF9leChpcCkucmVzdWx0O1xuXG5cblxuXG5cbmNvbnN0IGlzX2ludGVnZXI6IEZ1bmN0aW9uID0gKGlwOiBudW1iZXIpOiBib29sZWFuID0+XG5cbiAgICAoTnVtYmVyLmlzSW50ZWdlcihpcCkpXG4gJiYgKGlwID49IDApXG4gJiYgKGlwIDw9IDQyOTQ5NjcyOTUpOyAvLyAyNTUuMjU1LjI1NS4yNTVcblxuXG5cblxuXG5jb25zdCBpbnRlZ2VyX3RvX3F1YWQ6IEZ1bmN0aW9uID0gKGlwOiBudW1iZXIpOiBzdHJpbmcgPT4ge1xuXG4gIGlmICghKE51bWJlci5pc0ludGVnZXIoaXApKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdpbnRlZ2VyX3RvX3F1YWQgYWNjZXB0cyBvbmx5IGludGVnZXJzJyk7IH1cblxuICBpZiAoaXAgPCAwKSAgICAgICAgICB7IHRocm93IG5ldyBSYW5nZUVycm9yKCdJUCBpbnRlZ2VyIG11c3QgYmUgbm9uLW5lZ2F0aXZlJyk7IH1cbiAgaWYgKGlwID4gNDI5NDk2NzI5NSkgeyB0aHJvdyBuZXcgUmFuZ2VFcnJvcignTWF4aW11bSBJUCBpbnRlZ2VyIGlzIDQsMjk0LDk2NywyOTUnKTsgfVxuXG4gIHJldHVybiBgJHsoKGlwID4+IDI0KSAmIDB4RkYpfS4keygoaXAgPj4gMTYpICYgMHhGRil9LiR7KChpcCA+PiA4KSAmIDB4RkYpfS4keyhpcCAmIDB4RkYpfWA7ICAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWJpdHdpc2VcblxufTtcblxuXG5cblxuXG5jb25zdCBpbnRfYXJyYXlfdG9fcXVhZDogRnVuY3Rpb24gPSAoaWE6IEFycmF5PG51bWJlcj4pOiBzdHJpbmcgPT4ge1xuXG4gIGlmICghKEFycmF5LmlzQXJyYXkoaWEpKSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ2ludF9hcnJheV90b19xdWFkIHJlcXVpcmVzIGFuIGFycmF5IG9mIHVuc2lnbmVkIGJ5dGUgaW50ZWdlcnMnKTtcbiAgfVxuXG4gIGlmICgoaWEubGVuZ3RoIDwgNCkgfHwgKGlhLmxlbmd0aCA+IDQpKSB7XG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ2ludF9hcnJheV90b19xdWFkIHJlcXVpcmVzIGEgNC1ieXRlIGFycmF5Jyk7XG4gIH1cblxuICAvLyBjYW4ndCBiZSBhIG1hcCB0byB2YWxpZGF0ZSwgYmVjYXVzZSBhIG1hcCB3aWxsIHNraXAgaG9sZXNcbiAgZm9yIChsZXQgaTogbnVtYmVyID0gMDsgaSA8IDQ7ICsraSkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGZwL25vLWxvb3BzXG5cbiAgICBjb25zdCBieXRlOiBudW1iZXIgPSBpYVtpXTtcblxuICAgIGlmICgoYnl0ZSA9PT0gdW5kZWZpbmVkKSB8fCAoYnl0ZSA9PT0gbnVsbCkgfHwgaXNOYU4oYnl0ZSkpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoYGJ5dGUgJHtpfSBtdXN0IG5vdCBiZSB1bmRlZmluZWQsIG51bGwsIG9yIE5hTmApO1xuICAgIH1cblxuICAgIGlmICghKE51bWJlci5pc0ludGVnZXIoYnl0ZSkpKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdpbnRfYXJyYXlfdG9fcXVhZCBhY2NlcHRzIG9ubHkgYXJyYXlzIG9mIGludGVnZXJzJyk7XG4gICAgfVxuXG4gICAgaWYgKGJ5dGUgPCAwKSB7XG4gICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihgYnl0ZSAke2l9IHNob3VsZCBiZSBub24tbmVnYXRpdmVgKTtcbiAgICB9XG5cbiAgICBpZiAoYnl0ZSA+IDI1NSkge1xuICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoYGJ5dGUgJHtpfSBzaG91bGQgYmUgMjU1IG9yIGxvd2VyICh5J2tub3csIGEgYnl0ZSlgKTtcbiAgICB9XG5cbiAgfVxuXG4gIHJldHVybiBgJHtpYVswXX0uJHtpYVsxXX0uJHtpYVsyXX0uJHtpYVszXX1gO1xuXG59O1xuXG5cblxuXG5cbmZ1bmN0aW9uIFBhcnNlZFF1YWQoYTogbnVtYmVyLCBiOiBudW1iZXIsIGM6IG51bWJlciwgZDogbnVtYmVyKTogUGFyc2VkUXVhZCB7XG5cbiAgdGhpcy5hID0gYTtcbiAgdGhpcy5iID0gYjtcbiAgdGhpcy5jID0gYztcbiAgdGhpcy5kID0gZDtcblxuICByZXR1cm4gdGhpcztcblxufVxuXG5cblxuXG5cbmNvbnN0IHBhcnNlZF9xdWFkX3RvX3F1YWQ6IEZ1bmN0aW9uID0gKHthLCBiLCBjLCBkfSk6IHN0cmluZyA9PlxuXG4gIGAke2F9LiR7Yn0uJHtjfS4ke2R9YDtcblxuXG5cblxuXG5jb25zdCBhc19xdWFkOiBGdW5jdGlvbiA9IChpcDogSXApOiBzdHJpbmcgPT4ge1xuXG4gIGlmICh0eXBlb2YgaXAgPT09ICdudW1iZXInKSB7XG4gICAgcmV0dXJuIGludGVnZXJfdG9fcXVhZChpcCk7XG4gIH1cblxuICBlbHNlIGlmIChpcCBpbnN0YW5jZW9mIFBhcnNlZFF1YWQpIHtcbiAgICByZXR1cm4gcGFyc2VkX3F1YWRfdG9fcXVhZChpcCk7XG4gIH1cblxuICBlbHNlIGlmIChBcnJheS5pc0FycmF5KGlwKSkge1xuICAgIHJldHVybiBpbnRfYXJyYXlfdG9fcXVhZChpcCk7XG4gIH1cblxuICBlbHNlIGlmIChpc19xdWFkKGlwKSkgeyByZXR1cm4gaXA7IH1cblxuICB0aHJvdyBuZXcgRXJyb3IoJ2Nhbm5vdCBjb25zdHJ1Y3QgcXVhZCBmcm9tIHRoaXMgaW5wdXQnKTtcblxufTtcblxuXG5cblxuXG4vLyB0b2RvIHdoYXJnYXJibCBjb21lYmFjayBuZWVkcyB0byBoYW5kbGUgaW50ZWdlcnNcblxuY29uc3QgYXNfcGFyc2VkX3F1YWQ6IEZ1bmN0aW9uID0gKGlwOiBJcCk6IFBhcnNlZFF1YWQgPT4ge1xuXG4gIGlmIChpcCBpbnN0YW5jZW9mIFBhcnNlZFF1YWQpIHsgcmV0dXJuIGlwOyB9XG5cbiAgY29uc3QgYnl0ZXM6IEFycmF5PG51bWJlcj4gPSBhc19xdWFkKGlwKS5zcGxpdCgnLicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKCAoczogc3RyaW5nKTogbnVtYmVyID0+IHBhcnNlSW50KHMsIDEwKSk7XG5cbiAgcmV0dXJuIG5ldyBQYXJzZWRRdWFkKC4uLiBieXRlcyk7XG5cbn07XG5cblxuXG5cbmV4cG9ydCB7XG5cbi8vICAgIGlzX3NpbXBsZSxcblxuICAgIGlzX3F1YWQsXG4gICAgICBpc19xdWFkX2V4LFxuXG4gICAgaW50ZWdlcl90b19xdWFkLFxuICAgIGludF9hcnJheV90b19xdWFkLFxuXG4gICAgUGFyc2VkUXVhZCxcbiAgICBwYXJzZWRfcXVhZF90b19xdWFkLFxuXG4vLyAgICBpc19pbmNvbXBsZXRlX3F1YWQsXG4vLyAgICAgIGlzX2luY29tcGxldGVfcXVhZF9leCxcblxuICAgIGlzX2ludGVnZXIsXG5cbiAvLyAgICBpc19jb21wbGV4LCAgLy8gaGFzIHBvcnQgb3Igc3VibmV0IG1hc2tcbiAvLyAgICBpc19jb21wbGV4X3F1YWQsXG4gLy8gICAgaXNfY29tcGxleF9pbnRlZ2VyLFxuXG4gICAgYXNfcXVhZCxcbiAgICBhc19wYXJzZWRfcXVhZCxcbiAvLyAgICBhc19pbnRlZ2VyLFxuXG4gLy8gICAgaXNfcmFuZ2UsXG4gLy8gICAgaXNfY3VycmVudF9uZXR3b3JrLFxuXG4gLy8gICAgaXNfc3BlY2lhbCxcbiAvLyAgICBpc19sb29wYmFjayxcbiAvLyAgICBpc19saW5rX2xvY2FsLFxuIC8vICAgIGlzX2lldGZfcHJvdG9jb2wsXG4gLy8gICAgaXNfaXB2Nl90b19pcHY0X3JlbGF5LFxuIC8vICAgIGlzX2JlbmNobWFyayxcblxuIC8vICAgIGlzX3Rlc3RuZXQsXG4gLy8gICAgICBpc190ZXN0bmV0XzEsXG4gLy8gICAgICBpc190ZXN0bmV0XzIsXG4gLy8gICAgICBpc190ZXN0bmV0XzMsXG5cbiAvLyAgICBpc19wcml2YXRlLFxuIC8vICAgICAgaXNfcHJpdmF0ZV8xMCxcbiAvLyAgICAgIGlzX3ByaXZhdGVfMTcyLFxuIC8vICAgICAgaXNfcHJpdmF0ZV8xOTIsXG5cbiAvLyAgICBpc19zaGFyZWQsXG4gLy8gICAgaXNfbGluayxcbiAvLyAgICBpc19tdWx0aWNhc3QsXG4gLy8gICAgaXNfYnJvYWRjYXN0LFxuIC8vICAgIGlzX3N1Ym5ldCxcbiAvLyAgICBpc19zdWJuZXRfYnJvYWRjYXN0LFxuIC8vICAgIGlzX3Jlc2VydmVkLFxuXG4gICAgY2hlY2tcblxufTtcbiJdfQ==