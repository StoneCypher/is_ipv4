'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.check = exports.as_parsed_quad = exports.as_quad = exports.is_integer = exports.parsed_quad_to_quad = exports.ParsedQuad = exports.int_array_to_quad = exports.integer_to_quad = exports.is_quad_ex = exports.is_quad = undefined;

var _type_impls = require('./type_impls.js');

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

var fail = function fail(why) {
  return { result: false, reason: why };
};

var check = function check(_ip) {
  return false;
}; // whargarbl todo comeback


var letterFilter = new RegExp('^[0-9\\.]+$');

var check_quad = function check_quad(quad) {

  for (var i = 0; i < 4; ++i) {
    // eslint-disable-line fp/no-loops

    var b = quad[i];
    if (b.length === 0) {
      return fail('Byte ' + i + ' must not be empty');
    }

    var bt = parseInt(b, 10);

    // needn't check below zero, because character filter prevents minus signs
    if (bt > 255) {
      return fail('Byte ' + i + ' must be below 256');
    }

    if (b[0] === '0' && bt > 0) {
      return fail('Nonzero byte ' + i + ' must not begin with zero');
    }

    if (b.length > 1 && bt === 0) {
      return fail('Zero byte ' + i + ' must not have multiple zeroes');
    }
  }

  return { result: true };
};

var is_quad_ex = function is_quad_ex(ip) {

  if (!(typeof ip === 'string')) {
    return fail('All quads are strings');
  }

  if (!letterFilter.test(ip)) {
    return fail('A quad may only contain 0-9 and period');
  }

  var quad = ip.split('.');
  if (!(quad.length === 4)) {
    return fail('All complete quads have four bytes separated by periods');
  }

  return check_quad(quad);
};

var is_quad = function is_quad(ip) {
  return is_quad_ex(ip).result;
};

var is_integer = function is_integer(ip) {
  return Number.isInteger(ip) && ip >= 0 && ip <= 4294967295;
}; // 255.255.255.255


var integer_to_quad = function integer_to_quad(ip) {

  if (!Number.isInteger(ip)) {
    throw new TypeError('integer_to_quad accepts only integers');
  }

  if (ip < 0) {
    throw new RangeError('IP integer must be non-negative');
  }
  if (ip > 4294967295) {
    throw new RangeError('Maximum IP integer is 4,294,967,295');
  }

  return (ip >> 24 & 0xFF) + '.' + (ip >> 16 & 0xFF) + '.' + (ip >> 8 & 0xFF) + '.' + (ip & 0xFF); // eslint-disable-line no-bitwise
};

var int_array_to_quad = function int_array_to_quad(ia) {

  if (!Array.isArray(ia)) {
    throw new TypeError('int_array_to_quad requires an array of unsigned byte integers');
  }

  if (ia.length < 4 || ia.length > 4) {
    throw new RangeError('int_array_to_quad requires a 4-byte array');
  }

  // can't be a map to validate, because a map will skip holes
  for (var i = 0; i < 4; ++i) {
    // eslint-disable-line fp/no-loops

    var byte = ia[i];

    if (byte === undefined || byte === null || isNaN(byte)) {
      throw new TypeError('byte ' + i + ' must not be undefined, null, or NaN');
    }

    if (!Number.isInteger(byte)) {
      throw new TypeError('int_array_to_quad accepts only arrays of integers');
    }

    if (byte < 0) {
      throw new RangeError('byte ' + i + ' should be non-negative');
    }

    if (byte > 255) {
      throw new RangeError('byte ' + i + ' should be 255 or lower (y\'know, a byte)');
    }
  }

  return ia[0] + '.' + ia[1] + '.' + ia[2] + '.' + ia[3];
};

var parsed_quad_to_quad = function parsed_quad_to_quad(_ref) {
  var a = _ref.a,
      b = _ref.b,
      c = _ref.c,
      d = _ref.d;
  return a + '.' + b + '.' + c + '.' + d;
};

var as_quad = function as_quad(ip) {

  if (typeof ip === 'number') {
    return integer_to_quad(ip);
  } else if (ip instanceof _type_impls.ParsedQuad) {
    return parsed_quad_to_quad(ip);
  } else if (Array.isArray(ip)) {
    return int_array_to_quad(ip);
  } else if (is_quad(ip)) {
    return ip;
  }

  throw new Error('cannot construct quad from this input');
};

// todo whargarbl comeback needs to handle integers

var as_parsed_quad = function as_parsed_quad(ip) {

  if (ip instanceof _type_impls.ParsedQuad) {
    return ip;
  }

  var bytes = as_quad(ip).split('.').map(function (s) {
    return parseInt(s, 10);
  });

  return new (Function.prototype.bind.apply(_type_impls.ParsedQuad, [null].concat(_toConsumableArray(bytes))))();
};

exports.is_quad = is_quad;
exports.is_quad_ex = is_quad_ex;
exports.integer_to_quad = integer_to_quad;
exports.int_array_to_quad = int_array_to_quad;
exports.ParsedQuad = _type_impls.ParsedQuad;
exports.parsed_quad_to_quad = parsed_quad_to_quad;
exports.is_integer = is_integer;
exports.as_quad = as_quad;
exports.as_parsed_quad = as_parsed_quad;
exports.check = check;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9qcy9pc19pcHY0LmpzIl0sIm5hbWVzIjpbImZhaWwiLCJ3aHkiLCJyZXN1bHQiLCJyZWFzb24iLCJjaGVjayIsIl9pcCIsImxldHRlckZpbHRlciIsIlJlZ0V4cCIsImNoZWNrX3F1YWQiLCJxdWFkIiwiaSIsImIiLCJsZW5ndGgiLCJidCIsInBhcnNlSW50IiwiaXNfcXVhZF9leCIsImlwIiwidGVzdCIsInNwbGl0IiwiaXNfcXVhZCIsImlzX2ludGVnZXIiLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJpbnRlZ2VyX3RvX3F1YWQiLCJUeXBlRXJyb3IiLCJSYW5nZUVycm9yIiwiaW50X2FycmF5X3RvX3F1YWQiLCJpYSIsIkFycmF5IiwiaXNBcnJheSIsImJ5dGUiLCJ1bmRlZmluZWQiLCJpc05hTiIsInBhcnNlZF9xdWFkX3RvX3F1YWQiLCJhIiwiYyIsImQiLCJhc19xdWFkIiwiRXJyb3IiLCJhc19wYXJzZWRfcXVhZCIsImJ5dGVzIiwibWFwIiwicyIsIlBhcnNlZFF1YWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFjQTs7OztBQVVBLElBQU1BLE9BQWlCLFNBQWpCQSxJQUFpQixDQUFDQyxHQUFEO0FBQUEsU0FFcEIsRUFBRUMsUUFBUSxLQUFWLEVBQWlCQyxRQUFRRixHQUF6QixFQUZvQjtBQUFBLENBQXZCOztBQVFBLElBQU1HLFFBQWtCLFNBQWxCQSxLQUFrQixDQUFDQyxHQUFEO0FBQUEsU0FFdEIsS0FGc0I7QUFBQSxDQUF4QixDLENBRVU7OztBQU1WLElBQU1DLGVBQXVCLElBQUlDLE1BQUosQ0FBVyxhQUFYLENBQTdCOztBQU1BLElBQU1DLGFBQXVCLFNBQXZCQSxVQUF1QixDQUFDQyxJQUFELEVBQTJDOztBQUV0RSxPQUFLLElBQUlDLElBQVksQ0FBckIsRUFBd0JBLElBQUUsQ0FBMUIsRUFBNkIsRUFBRUEsQ0FBL0IsRUFBa0M7QUFBRTs7QUFFbEMsUUFBTUMsSUFBWUYsS0FBS0MsQ0FBTCxDQUFsQjtBQUNBLFFBQUlDLEVBQUVD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QUlZLE1BQU1DLE9BQU4sQ0FBY2IsRUFBZCxDQUFKLEVBQXVCO0FBQzFCLFdBQU9VLGtCQUFrQlYsRUFBbEIsQ0FBUDtBQUNELEdBRkksTUFJQSxJQUFJRyxRQUFRSCxFQUFSLENBQUosRUFBaUI7QUFBRSxXQUFPQSxFQUFQO0FBQVk7O0FBRXBDLFFBQU0sSUFBSXNCLEtBQUosQ0FBVSx1Q0FBVixDQUFOO0FBRUQsQ0FsQkQ7O0FBd0JBOztBQUVBLElBQU1DLGlCQUEyQixTQUEzQkEsY0FBMkIsQ0FBQ3ZCLEVBQUQsRUFBd0I7O0FBRXZELE1BQUlBLG9DQUFKLEVBQThCO0FBQUUsV0FBT0EsRUFBUDtBQUFZOztBQUU1QyxNQUFNd0IsUUFBdUJILFFBQVFyQixFQUFSLEVBQVlFLEtBQVosQ0FBa0IsR0FBbEIsRUFDWXVCLEdBRFosQ0FDaUIsVUFBQ0MsQ0FBRDtBQUFBLFdBQXVCNUIsU0FBUzRCLENBQVQsRUFBWSxFQUFaLENBQXZCO0FBQUEsR0FEakIsQ0FBN0I7O0FBR0EscUdBQTBCRixLQUExQjtBQUVELENBVEQ7O1FBa0JJckIsTyxHQUFBQSxPO1FBQ0VKLFUsR0FBQUEsVTtRQUVGUSxlLEdBQUFBLGU7UUFDQUcsaUIsR0FBQUEsaUI7UUFFQWlCLFU7UUFDQVYsbUIsR0FBQUEsbUI7UUFLQWIsVSxHQUFBQSxVO1FBTUFpQixPLEdBQUFBLE87UUFDQUUsYyxHQUFBQSxjO1FBK0JBbkMsSyxHQUFBQSxLIiwiZmlsZSI6ImlzX2lwdjQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuLy8gQGZsb3dcclxuXHJcbmltcG9ydCB0eXBlIHtcclxuXHJcbiAgSXAsXHJcbiAgUmVzdWx0XHJcblxyXG59IGZyb20gJy4vdHlwZXMnO1xyXG5cclxuXHJcblxyXG5cclxuXHJcbmltcG9ydCB7XHJcblxyXG4gIFBhcnNlZFF1YWRcclxuXHJcbn0gZnJvbSAnLi90eXBlX2ltcGxzLmpzJztcclxuXHJcblxyXG5cclxuXHJcblxyXG5jb25zdCBmYWlsOiBGdW5jdGlvbiA9ICh3aHk6IHN0cmluZyk6IFJlc3VsdCA9PlxyXG5cclxuICAoeyByZXN1bHQ6IGZhbHNlLCByZWFzb246IHdoeSB9KTtcclxuXHJcblxyXG5cclxuXHJcblxyXG5jb25zdCBjaGVjazogRnVuY3Rpb24gPSAoX2lwOiBJcCk6IGJvb2xlYW4gPT5cclxuXHJcbiAgZmFsc2U7ICAvLyB3aGFyZ2FyYmwgdG9kbyBjb21lYmFja1xyXG5cclxuXHJcblxyXG5cclxuXHJcbmNvbnN0IGxldHRlckZpbHRlcjogUmVnRXhwID0gbmV3IFJlZ0V4cCgnXlswLTlcXFxcLl0rJCcpO1xyXG5cclxuXHJcblxyXG5cclxuXHJcbmNvbnN0IGNoZWNrX3F1YWQ6IEZ1bmN0aW9uID0gKHF1YWQ6IEFycmF5PHN0cmluZz4pOiBSZXN1bHQgfCBib29sZWFuID0+IHtcclxuXHJcbiAgZm9yIChsZXQgaTogbnVtYmVyID0gMDsgaTw0OyArK2kpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBmcC9uby1sb29wc1xyXG5cclxuICAgIGNvbnN0IGI6IHN0cmluZyA9IHF1YWRbaV07XHJcbiAgICBpZiAoYi5sZW5ndGggPT09IDApIHsgcmV0dXJuIGZhaWwoYEJ5dGUgJHtpfSBtdXN0IG5vdCBiZSBlbXB0eWApOyB9XHJcblxyXG4gICAgY29uc3QgYnQ6IG51bWJlciA9IHBhcnNlSW50KGIsIDEwKTtcclxuXHJcbiAgICAvLyBuZWVkbid0IGNoZWNrIGJlbG93IHplcm8sIGJlY2F1c2UgY2hhcmFjdGVyIGZpbHRlciBwcmV2ZW50cyBtaW51cyBzaWduc1xyXG4gICAgaWYgKGJ0ID4gMjU1KSB7IHJldHVybiBmYWlsKGBCeXRlICR7aX0gbXVzdCBiZSBiZWxvdyAyNTZgKTsgfVxyXG5cclxuICAgIGlmICgoYlswXSA9PT0gJzAnKSAmJiAoYnQgPiAwKSkge1xyXG4gICAgICByZXR1cm4gZmFpbChgTm9uemVybyBieXRlICR7aX0gbXVzdCBub3QgYmVnaW4gd2l0aCB6ZXJvYCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKChiLmxlbmd0aCA+IDEpICYmIChidCA9PT0gMCkpIHtcclxuICAgICAgcmV0dXJuIGZhaWwoYFplcm8gYnl0ZSAke2l9IG11c3Qgbm90IGhhdmUgbXVsdGlwbGUgemVyb2VzYCk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHsgcmVzdWx0OiB0cnVlIH07XHJcblxyXG59O1xyXG5cclxuXHJcblxyXG5cclxuXHJcbmNvbnN0IGlzX3F1YWRfZXg6IEZ1bmN0aW9uID0gKGlwOiBJcCk6IFJlc3VsdCA9PiB7XHJcblxyXG4gIGlmICghKCB0eXBlb2YoaXApID09PSAnc3RyaW5nJyApKSB7XHJcbiAgICByZXR1cm4gZmFpbCgnQWxsIHF1YWRzIGFyZSBzdHJpbmdzJyk7XHJcbiAgfVxyXG5cclxuICBpZiAoISggbGV0dGVyRmlsdGVyLnRlc3QoaXApICkpIHtcclxuICAgIHJldHVybiBmYWlsKCdBIHF1YWQgbWF5IG9ubHkgY29udGFpbiAwLTkgYW5kIHBlcmlvZCcpO1xyXG4gIH1cclxuXHJcblxyXG4gIGNvbnN0IHF1YWQ6IEFycmF5PHN0cmluZz4gPSBpcC5zcGxpdCgnLicpO1xyXG4gIGlmICghKHF1YWQubGVuZ3RoID09PSA0KSkgeyByZXR1cm4gZmFpbCgnQWxsIGNvbXBsZXRlIHF1YWRzIGhhdmUgZm91ciBieXRlcyBzZXBhcmF0ZWQgYnkgcGVyaW9kcycpOyB9XHJcblxyXG4gIHJldHVybiBjaGVja19xdWFkKHF1YWQpO1xyXG5cclxufTtcclxuXHJcblxyXG5cclxuXHJcblxyXG5jb25zdCBpc19xdWFkOiBGdW5jdGlvbiA9IChpcDogSXApOiBib29sZWFuID0+XHJcblxyXG4gIGlzX3F1YWRfZXgoaXApLnJlc3VsdDtcclxuXHJcblxyXG5cclxuXHJcblxyXG5jb25zdCBpc19pbnRlZ2VyOiBGdW5jdGlvbiA9IChpcDogbnVtYmVyKTogYm9vbGVhbiA9PlxyXG5cclxuICAgIChOdW1iZXIuaXNJbnRlZ2VyKGlwKSlcclxuICYmIChpcCA+PSAwKVxyXG4gJiYgKGlwIDw9IDQyOTQ5NjcyOTUpOyAvLyAyNTUuMjU1LjI1NS4yNTVcclxuXHJcblxyXG5cclxuXHJcblxyXG5jb25zdCBpbnRlZ2VyX3RvX3F1YWQ6IEZ1bmN0aW9uID0gKGlwOiBudW1iZXIpOiBzdHJpbmcgPT4ge1xyXG5cclxuICBpZiAoIShOdW1iZXIuaXNJbnRlZ2VyKGlwKSkpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignaW50ZWdlcl90b19xdWFkIGFjY2VwdHMgb25seSBpbnRlZ2VycycpOyB9XHJcblxyXG4gIGlmIChpcCA8IDApICAgICAgICAgIHsgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0lQIGludGVnZXIgbXVzdCBiZSBub24tbmVnYXRpdmUnKTsgfVxyXG4gIGlmIChpcCA+IDQyOTQ5NjcyOTUpIHsgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ01heGltdW0gSVAgaW50ZWdlciBpcyA0LDI5NCw5NjcsMjk1Jyk7IH1cclxuXHJcbiAgcmV0dXJuIGAkeygoaXAgPj4gMjQpICYgMHhGRil9LiR7KChpcCA+PiAxNikgJiAweEZGKX0uJHsoKGlwID4+IDgpICYgMHhGRil9LiR7KGlwICYgMHhGRil9YDsgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tYml0d2lzZVxyXG5cclxufTtcclxuXHJcblxyXG5cclxuXHJcblxyXG5jb25zdCBpbnRfYXJyYXlfdG9fcXVhZDogRnVuY3Rpb24gPSAoaWE6IEFycmF5PG51bWJlcj4pOiBzdHJpbmcgPT4ge1xyXG5cclxuICBpZiAoIShBcnJheS5pc0FycmF5KGlhKSkpIHtcclxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ2ludF9hcnJheV90b19xdWFkIHJlcXVpcmVzIGFuIGFycmF5IG9mIHVuc2lnbmVkIGJ5dGUgaW50ZWdlcnMnKTtcclxuICB9XHJcblxyXG4gIGlmICgoaWEubGVuZ3RoIDwgNCkgfHwgKGlhLmxlbmd0aCA+IDQpKSB7XHJcbiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignaW50X2FycmF5X3RvX3F1YWQgcmVxdWlyZXMgYSA0LWJ5dGUgYXJyYXknKTtcclxuICB9XHJcblxyXG4gIC8vIGNhbid0IGJlIGEgbWFwIHRvIHZhbGlkYXRlLCBiZWNhdXNlIGEgbWFwIHdpbGwgc2tpcCBob2xlc1xyXG4gIGZvciAobGV0IGk6IG51bWJlciA9IDA7IGkgPCA0OyArK2kpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBmcC9uby1sb29wc1xyXG5cclxuICAgIGNvbnN0IGJ5dGU6IG51bWJlciA9IGlhW2ldO1xyXG5cclxuICAgIGlmICgoYnl0ZSA9PT0gdW5kZWZpbmVkKSB8fCAoYnl0ZSA9PT0gbnVsbCkgfHwgaXNOYU4oYnl0ZSkpIHtcclxuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgYnl0ZSAke2l9IG11c3Qgbm90IGJlIHVuZGVmaW5lZCwgbnVsbCwgb3IgTmFOYCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCEoTnVtYmVyLmlzSW50ZWdlcihieXRlKSkpIHtcclxuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignaW50X2FycmF5X3RvX3F1YWQgYWNjZXB0cyBvbmx5IGFycmF5cyBvZiBpbnRlZ2VycycpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChieXRlIDwgMCkge1xyXG4gICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihgYnl0ZSAke2l9IHNob3VsZCBiZSBub24tbmVnYXRpdmVgKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoYnl0ZSA+IDI1NSkge1xyXG4gICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihgYnl0ZSAke2l9IHNob3VsZCBiZSAyNTUgb3IgbG93ZXIgKHkna25vdywgYSBieXRlKWApO1xyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIHJldHVybiBgJHtpYVswXX0uJHtpYVsxXX0uJHtpYVsyXX0uJHtpYVszXX1gO1xyXG5cclxufTtcclxuXHJcblxyXG5cclxuXHJcblxyXG5jb25zdCBwYXJzZWRfcXVhZF90b19xdWFkOiBGdW5jdGlvbiA9ICh7YSwgYiwgYywgZH0pOiBzdHJpbmcgPT5cclxuXHJcbiAgYCR7YX0uJHtifS4ke2N9LiR7ZH1gO1xyXG5cclxuXHJcblxyXG5cclxuXHJcbmNvbnN0IGFzX3F1YWQ6IEZ1bmN0aW9uID0gKGlwOiBJcCk6IHN0cmluZyA9PiB7XHJcblxyXG4gIGlmICh0eXBlb2YgaXAgPT09ICdudW1iZXInKSB7XHJcbiAgICByZXR1cm4gaW50ZWdlcl90b19xdWFkKGlwKTtcclxuICB9XHJcblxyXG4gIGVsc2UgaWYgKGlwIGluc3RhbmNlb2YgUGFyc2VkUXVhZCkge1xyXG4gICAgcmV0dXJuIHBhcnNlZF9xdWFkX3RvX3F1YWQoaXApO1xyXG4gIH1cclxuXHJcbiAgZWxzZSBpZiAoQXJyYXkuaXNBcnJheShpcCkpIHtcclxuICAgIHJldHVybiBpbnRfYXJyYXlfdG9fcXVhZChpcCk7XHJcbiAgfVxyXG5cclxuICBlbHNlIGlmIChpc19xdWFkKGlwKSkgeyByZXR1cm4gaXA7IH1cclxuXHJcbiAgdGhyb3cgbmV3IEVycm9yKCdjYW5ub3QgY29uc3RydWN0IHF1YWQgZnJvbSB0aGlzIGlucHV0Jyk7XHJcblxyXG59O1xyXG5cclxuXHJcblxyXG5cclxuXHJcbi8vIHRvZG8gd2hhcmdhcmJsIGNvbWViYWNrIG5lZWRzIHRvIGhhbmRsZSBpbnRlZ2Vyc1xyXG5cclxuY29uc3QgYXNfcGFyc2VkX3F1YWQ6IEZ1bmN0aW9uID0gKGlwOiBJcCk6IFBhcnNlZFF1YWQgPT4ge1xyXG5cclxuICBpZiAoaXAgaW5zdGFuY2VvZiBQYXJzZWRRdWFkKSB7IHJldHVybiBpcDsgfVxyXG5cclxuICBjb25zdCBieXRlczogQXJyYXk8bnVtYmVyPiA9IGFzX3F1YWQoaXApLnNwbGl0KCcuJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCggKHM6IHN0cmluZyk6IG51bWJlciA9PiBwYXJzZUludChzLCAxMCkpO1xyXG5cclxuICByZXR1cm4gbmV3IFBhcnNlZFF1YWQoLi4uIGJ5dGVzKTtcclxuXHJcbn07XHJcblxyXG5cclxuXHJcblxyXG5leHBvcnQge1xyXG5cclxuLy8gICAgaXNfc2ltcGxlLFxyXG5cclxuICAgIGlzX3F1YWQsXHJcbiAgICAgIGlzX3F1YWRfZXgsXHJcblxyXG4gICAgaW50ZWdlcl90b19xdWFkLFxyXG4gICAgaW50X2FycmF5X3RvX3F1YWQsXHJcblxyXG4gICAgUGFyc2VkUXVhZCxcclxuICAgIHBhcnNlZF9xdWFkX3RvX3F1YWQsXHJcblxyXG4vLyAgICBpc19pbmNvbXBsZXRlX3F1YWQsXHJcbi8vICAgICAgaXNfaW5jb21wbGV0ZV9xdWFkX2V4LFxyXG5cclxuICAgIGlzX2ludGVnZXIsXHJcblxyXG4gLy8gICAgaXNfY29tcGxleCwgIC8vIGhhcyBwb3J0IG9yIHN1Ym5ldCBtYXNrXHJcbiAvLyAgICBpc19jb21wbGV4X3F1YWQsXHJcbiAvLyAgICBpc19jb21wbGV4X2ludGVnZXIsXHJcblxyXG4gICAgYXNfcXVhZCxcclxuICAgIGFzX3BhcnNlZF9xdWFkLFxyXG4gLy8gICAgYXNfaW50ZWdlcixcclxuXHJcbiAvLyAgICBpc19yYW5nZSxcclxuIC8vICAgIGlzX2N1cnJlbnRfbmV0d29yayxcclxuXHJcbiAvLyAgICBpc19zcGVjaWFsLFxyXG4gLy8gICAgaXNfbG9vcGJhY2ssXHJcbiAvLyAgICBpc19saW5rX2xvY2FsLFxyXG4gLy8gICAgaXNfaWV0Zl9wcm90b2NvbCxcclxuIC8vICAgIGlzX2lwdjZfdG9faXB2NF9yZWxheSxcclxuIC8vICAgIGlzX2JlbmNobWFyayxcclxuXHJcbiAvLyAgICBpc190ZXN0bmV0LFxyXG4gLy8gICAgICBpc190ZXN0bmV0XzEsXHJcbiAvLyAgICAgIGlzX3Rlc3RuZXRfMixcclxuIC8vICAgICAgaXNfdGVzdG5ldF8zLFxyXG5cclxuIC8vICAgIGlzX3ByaXZhdGUsXHJcbiAvLyAgICAgIGlzX3ByaXZhdGVfMTAsXHJcbiAvLyAgICAgIGlzX3ByaXZhdGVfMTcyLFxyXG4gLy8gICAgICBpc19wcml2YXRlXzE5MixcclxuXHJcbiAvLyAgICBpc19zaGFyZWQsXHJcbiAvLyAgICBpc19saW5rLFxyXG4gLy8gICAgaXNfbXVsdGljYXN0LFxyXG4gLy8gICAgaXNfYnJvYWRjYXN0LFxyXG4gLy8gICAgaXNfc3VibmV0LFxyXG4gLy8gICAgaXNfc3VibmV0X2Jyb2FkY2FzdCxcclxuIC8vICAgIGlzX3Jlc2VydmVkLFxyXG5cclxuICAgIGNoZWNrXHJcblxyXG59O1xyXG4iXX0=